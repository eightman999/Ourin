<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROPERTY System — **1.0M for macOS (Ourin)** 仕様書（UKADOC準拠・完全版）</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", "Hiragino Kaku Gothic ProN", "Hiragino Sans", "游ゴシック", YuGothic, "メイリオ", Meiryo, sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .content {
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .lang-switcher {
            text-align: right;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }
        .lang-switcher a {
            margin: 0 5px;
            padding: 5px 15px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 3px;
            text-decoration: none;
            color: #333;
        }
        .lang-switcher a:hover {
            background-color: #e0e0e0;
        }
        .lang-switcher a.active {
            background-color: #0066cc;
            color: white;
            border-color: #0066cc;
        }
        h1 {
            border-bottom: 3px solid #333;
            padding-bottom: 10px;
            color: #333;
        }
        h2 {
            border-bottom: 2px solid #666;
            padding-bottom: 8px;
            margin-top: 30px;
            color: #444;
        }
        h3 {
            margin-top: 25px;
            color: #555;
        }
        code {
            background-color: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: "SF Mono", "Menlo", "Monaco", "Courier New", monospace;
            font-size: 0.9em;
        }
        pre {
            background-color: #f4f4f4;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border-left: 4px solid #333;
        }
        pre code {
            background-color: transparent;
            padding: 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #f8f8f8;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        a {
            color: #0066cc;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        blockquote {
            border-left: 4px solid #ddd;
            padding-left: 20px;
            margin-left: 0;
            color: #666;
            font-style: italic;
        }
        ul, ol {
            padding-left: 30px;
        }
        li {
            margin: 8px 0;
        }
        hr {
            border: none;
            border-top: 2px solid #ddd;
            margin: 30px 0;
        }
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #0066cc;
            text-decoration: none;
        }
        .back-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="content">
        <div class="lang-switcher">
            
        </div>
        <div class="back-link">
            <a href="index.html">← 目次に戻る</a>
        </div>
        <h1 id="property-system-10m-for-macos-ourin-ukadoc">PROPERTY System — <strong>1.0M for macOS (Ourin)</strong> 仕様書（UKADOC準拠・完全版）</h1>
<p><strong>Status:</strong> Draft / Ourin (macOS 10.15+ / Universal 2)<br />
<strong>Updated:</strong> 2025-07-28 (JST)<br />
<strong>互換方針:</strong> UKADOC「プロパティシステム」の<strong>語彙・意味</strong>を尊重し、<strong>OS 依存点のみ macOS ネイティブ（M‑Diff）</strong>として置換。<br />
<strong>対象:</strong> ゴースト作者・SHIORI実装者・Ourin（ベースウェア）実装者。</p>
<blockquote>
<p>参考: UKADOC のプロパティシステム本体／操作タグ（![get,property], ![set,property]）を正とする。<br />
本仕様は <strong>macOS差分</strong>と<strong>実装ガイドライン</strong>を追加したもの。</p>
</blockquote>
<hr />
<h2 id="_1">目次</h2>
<ul>
<li><a href="#1-目的と適用範囲">1. 目的と適用範囲</a></li>
<li><a href="#2-利用方法環境変数タグ">2. 利用方法（環境変数／タグ）</a></li>
<li><a href="#3-m-diffmacos置換点">3. M‑Diff（macOS置換点）</a></li>
<li><a href="#4-プロパティ一覧完全">4. プロパティ一覧（完全）</a></li>
<li><a href="#41-system">4.1 system.*</a></li>
<li><a href="#42-baseware">4.2 baseware.*</a></li>
<li><a href="#43-ghostlist--activeghostlist--currentghost">4.3 ghostlist.<em> / activeghostlist.</em> / currentghost.*</a></li>
<li><a href="#44-currentghostshelllist">4.4 currentghost.shelllist.*</a></li>
<li><a href="#45-currentghostscope--surface--rect--name">4.5 currentghost.scope(*) / surface / rect / name</a></li>
<li><a href="#46-currentghostserikocursor--tooltip">4.6 currentghost.seriko.cursor.<em> / tooltip.</em></a></li>
<li><a href="#47-currentghostserikosurfacelist">4.7 currentghost.seriko.surfacelist.*</a></li>
<li><a href="#48-currentghostballoonscope-系">4.8 currentghost.balloon.scope(*) 系</a></li>
<li><a href="#49-balloonlist--headlinelist--pluginlist">4.9 balloonlist.<em> / headlinelist.</em> / pluginlist.*</a></li>
<li><a href="#410-historyghostballoonheadlineplugin">4.10 history.(ghost|balloon|headline|plugin).*</a></li>
<li><a href="#411-rateofuselist">4.11 rateofuselist.*</a></li>
<li><a href="#412-汎用プロパティ名">4.12 汎用プロパティ名</a></li>
<li><a href="#5-書込可能set有効一覧">5. 書込可能（SET有効）一覧</a></li>
<li><a href="#6-例参照取得設定">6. 例：参照・取得・設定</a></li>
<li><a href="#7-互換性注意事項">7. 互換性・注意事項</a></li>
<li><a href="#8-変更履歴">8. 変更履歴</a></li>
</ul>
<hr />
<h2 id="1">1. 目的と適用範囲</h2>
<ul>
<li><strong>目的</strong>：SSP のプロパティシステム互換の<strong>語彙</strong>を維持しつつ、Ourin（macOS）で<strong>同等動作</strong>を保証する。  </li>
<li><strong>非目標</strong>：Windows 固有 API 値（HWND 等）や Win32 カーソルそのものの完全再現。</li>
</ul>
<h2 id="2">2. 利用方法（環境変数／タグ）</h2>
<ul>
<li>環境変数：<code>%property[&lt;name&gt;]</code> で <strong>値を埋め込み</strong>。  </li>
<li>取得タグ：<code>\![get,property,&lt;event&gt;,&lt;name1&gt;,&lt;name2&gt;...]</code> で <strong>任意イベント</strong>を発生させ、<code>reference0..</code> に値群が入る。  </li>
<li>設定タグ：<code>\![set,property,&lt;name&gt;,&lt;value&gt;]</code> で <strong>書き込み</strong>（対象が[SET有効]のみ）。</li>
</ul>
<h2 id="3-mdiffmacos">3. M‑Diff（macOS置換点）</h2>
<ul>
<li><strong>文字コード</strong>：既定 <strong>UTF‑8</strong>。互換のため <strong>CP932/Shift_JIS</strong> を受理し内部 UTF‑8 へ正規化。  </li>
<li><strong>パス</strong>：<code>path</code> 系・各 <code>*.filename</code> は <strong>POSIX 絶対パス</strong>または <strong><code>file://</code> URL</strong>を標準。相対は「シェル→ゴースト」順で探索。  </li>
<li><strong>座標（screen/rect）</strong>：<strong>仮想デスクトップのグローバル座標</strong>、<strong>原点(0,0)はメインディスプレイ左上</strong>。Cocoa座標との差は Ourin が吸収。  </li>
<li><strong>カーソルファイル</strong>：<code>*.mousecursor*</code> は surfaces.txt の <code>cursor</code> セクションと<strong>同じ指定</strong>。<code>.cur/.ani</code> 相当は Ourin が内部でデコード（macOS NSCursor へ変換）し、相対パスは「シェル→ゴースト」。  </li>
<li><strong>時間</strong>：<code>system.*</code> の時刻は OS 現地時刻。</li>
</ul>
<hr />
<h2 id="4">4. プロパティ一覧（完全）</h2>
<h3 id="41-system">4.1 <code>system.*</code></h3>
<ul>
<li><code>system.year</code> / <code>month</code> / <code>day</code> / <code>hour</code> / <code>minute</code> / <code>second</code> / <code>millisecond</code> / <code>dayofweek</code>  </li>
<li><code>system.cursor.pos</code> : <code>X,Y</code>（ピクセル、グローバル座標）。  </li>
<li><code>system.os.(type|name|version|build|parenttype|parentname)</code>：macOS では <code>type=macOS</code>、<code>name</code> 例: <code>macOS 14</code>、<code>version</code> は Darwin カーネル等。<code>parent*</code> は互換層がある場合のみ。  </li>
<li><code>system.cpu.(load|num|vendor|name|clock|features)</code>  </li>
<li><code>system.memory.(load|phyt|phya)</code></li>
</ul>
<h3 id="42-baseware">4.2 <code>baseware.*</code></h3>
<ul>
<li><code>baseware.version</code> / <code>baseware.name</code></li>
</ul>
<h3 id="43-ghostlist-activeghostlist-currentghost">4.3 <code>ghostlist.*</code> / <code>activeghostlist.*</code> / <code>currentghost.*</code></h3>
<ul>
<li><code>ghostlist.count</code>、<code>ghostlist(&lt;名前/相方名/パス&gt;).汎用プロパティ名</code>、<code>.icon</code>、<code>.index(ID)</code>、<code>.current</code>。  </li>
<li><code>activeghostlist.*</code>：起動中のゴーストの列挙。  </li>
<li><code>currentghost.汎用プロパティ名</code>、<code>currentghost.status</code>（Status ヘッダ互換：<code>talking|passive|induction|timecritical|nouserbreak|online|choosing|minimizing|opening(...)/balloon(...)</code>）。</li>
</ul>
<h3 id="44-currentghostshelllist">4.4 <code>currentghost.shelllist.*</code></h3>
<ul>
<li><code>currentghost.shelllist(&lt;シェル名/パス&gt;).汎用プロパティ名</code> / <code>.index(ID)</code> / <code>.current</code> / <code>.count</code>。</li>
</ul>
<h3 id="45-currentghostscope-surface-rect-name">4.5 <code>currentghost.scope(*) / surface / rect / name</code></h3>
<ul>
<li><code>currentghost.scope.count</code>：最大キャラ数。  </li>
<li><code>currentghost.scope(ID).surface.num</code>：表示サーフェスID。  </li>
<li><code>currentghost.scope(ID).seriko.defaultsurface</code>：既定サーフェス。  </li>
<li><code>currentghost.scope(ID).surface.x|y</code>：サーフェスのローカル座標。  </li>
<li><code>currentghost.scope(ID).x|y</code>：<strong>スクリーン座標</strong>の基準点（通常はサーフェス中央下）。  </li>
<li><code>currentghost.scope(ID).rect</code>：ウィンドウ矩形 <code>(left,top,right,bottom)</code>。  </li>
<li><code>currentghost.scope(ID).name</code>：スコープ名（0=さくら、1=相方、2+=char*）。</li>
</ul>
<h3 id="46-currentghostserikocursor-tooltip">4.6 <code>currentghost.seriko.cursor.*</code> / <code>tooltip.*</code></h3>
<ul>
<li><code>currentghost.mousecursor(.*)</code> / <code>currentghost.balloon.mousecursor(.*)</code>：<strong>相対パスは「シェル→ゴースト」探索</strong>。空文字を <code>SET</code> で<strong>定義削除</strong>。  </li>
<li><code>currentghost.seriko.cursor.scope(ID).mouse????list(&lt;当たり判定&gt;).(path|name)</code>、<code>.index(ID2).(path|name)</code>、<code>.count</code>。  </li>
<li><code>currentghost.seriko.tooltip.scope(ID).textlist(&lt;当たり判定&gt;).(text|name)</code>、<code>.index(ID2).(text|name)</code>、<code>.count</code>。</li>
</ul>
<h3 id="47-currentghostserikosurfacelist">4.7 <code>currentghost.seriko.surfacelist.*</code></h3>
<ul>
<li><code>.all</code>：有効なサーフェスIDの<strong>全て</strong>（カンマ区切り）。  </li>
<li><code>.defined</code>：surfaces.txt 内で <strong>定義ありのもの</strong>（カンマ区切り）。</li>
</ul>
<h3 id="48-currentghostballoonscopeid">4.8 <code>currentghost.balloon.scope(ID).*</code></h3>
<ul>
<li><code>.count</code>（画像数）、<code>.num</code>（ID）、<code>.validwidth(.initial)</code>、<code>.validheight(.initial)</code>、<code>.lines(.initial)</code>、<code>.basepos.x|y</code>、<code>.char_width</code>。</li>
</ul>
<h3 id="49-balloonlist-headlinelist-pluginlist">4.9 <code>balloonlist.*</code> / <code>headlinelist.*</code> / <code>pluginlist.*</code></h3>
<ul>
<li><code>&lt;list&gt;(&lt;名前/パス&gt;).汎用プロパティ名</code> / <code>.index(ID).汎用プロパティ名</code> / <code>.count</code>。</li>
</ul>
<h3 id="410-historyghostballoonheadlineplugin">4.10 <code>history.(ghost|balloon|headline|plugin).*</code></h3>
<ul>
<li>それぞれ <code>&lt;list&gt;(&lt;名前/パス&gt;).汎用プロパティ名</code> / <code>.index(ID).汎用プロパティ名</code> / <code>.count</code>。</li>
</ul>
<h3 id="411-rateofuselist">4.11 <code>rateofuselist.*</code></h3>
<ul>
<li><code>(name|sakuraname|keroname|boottime|bootminute|percent)</code> と <code>index(順位).&lt;同名&gt;</code>。</li>
</ul>
<h3 id="412">4.12 汎用プロパティ名</h3>
<ul>
<li><code>name / sakuraname / keroname / craftmanw / craftmanurl / path / thumbnail / update_result / update_time / homeurl / username / shiori.&lt;変数名&gt; / index / menu / sakura.bind.menu / kero.bind.menu / char*.bind.menu</code></li>
</ul>
<hr />
<h2 id="5-set">5. 書込可能（SET有効）一覧</h2>
<ul>
<li><strong>カーソル</strong>：<code>currentghost.mousecursor(.*)</code>、<code>currentghost.balloon.mousecursor(.*)</code>、<code>currentghost.seriko.cursor.scope(ID).mouse????list(...).path</code>、<code>.index(ID2).path</code>。  </li>
<li><strong>ツールチップ</strong>：<code>currentghost.seriko.tooltip.scope(ID).textlist(...).text</code>、<code>.index(ID2).text</code>。  </li>
<li><strong>シェル/着せ替えメニュー</strong>：<code>currentghost.shelllist(...).menu</code>、<code>currentghost.(sakura|kero|char*).bind.menu</code>。</li>
</ul>
<hr />
<h2 id="6">6. 例：参照・取得・設定</h2>
<p><strong>参照（環境変数）</strong>  </p>
<div class="codehilite"><pre><span></span><code><span class="nf">%property</span><span class="p">[</span><span class="n">baseware</span><span class="p">.</span><span class="n">name</span><span class="p">]</span><span class="w"> </span><span class="n">ver</span><span class="p">.</span><span class="w"> </span><span class="nf">%property</span><span class="p">[</span><span class="n">baseware</span><span class="p">.</span><span class="n">version</span><span class="p">]</span>
</code></pre></div>

<p><strong>取得（イベントで受け取り）</strong>  </p>
<div class="codehilite"><pre><span></span><code>\![get,property,OnGetSakuraName,ghostlist(Emily/Phase4.5).keroname]
// → SHIORI側 OnGetSakuraName の reference0 に値が入る
</code></pre></div>

<p><strong>設定（メニューからシェルを非表示）</strong>  </p>
<div class="codehilite"><pre><span></span><code>\![set,property,currentghost.shelllist(ULTIMATE FORM).menu,hidden]
</code></pre></div>

<p><strong>設定（当たり判定ヘッドのツールチップ）</strong>  </p>
<div class="codehilite"><pre><span></span><code>\<span class="o">!</span><span class="p">[</span><span class="n">set</span><span class="p">,</span><span class="n">property</span><span class="p">,</span><span class="n">currentghost</span><span class="o">.</span><span class="n">seriko</span><span class="o">.</span><span class="n">tooltip</span><span class="o">.</span><span class="n">scope</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">textlist</span><span class="p">(</span><span class="n">Head</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">,</span><span class="err">頭をなでる</span><span class="p">]</span>
</code></pre></div>

<hr />
<h2 id="7">7. 互換性・注意事項</h2>
<ul>
<li><strong>相対パス探索</strong>：シェル→ゴーストの順で探索。空文字 <code>SET</code> は<strong>定義削除</strong>。  </li>
<li><strong>スクリーン座標</strong>：Windows と同じく <strong>メインディスプレイ左上(0,0)</strong> を起点とする <strong>仮想デスクトップ座標</strong>に統一。Ourin 内部で Cocoa/CG の差を吸収。  </li>
<li><strong>SJIS受理</strong>：<code>get/set</code> 受信で CP932 を受理、内部は UTF‑8 に統一。  </li>
<li><strong>未知要素</strong>：将来拡張のため読み取りは透過、書込は無視＋警告ログ。</li>
</ul>
<hr />
<h2 id="8">8. 変更履歴</h2>
<ul>
<li>2025-07-28 (JST): 初版（1.0M for macOS）。</li>
</ul>
        <div class="footer">
            <p>Generated: 2025-10-23 | <a href="../README_ja-jp.md">Source (MD)</a></p>
        </div>
    </div>
</body>
</html>
