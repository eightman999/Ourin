<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHIORI Resource — **3.0M‑Mac 仕様書（完全版 / UKADOC準拠）**</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", "Hiragino Kaku Gothic ProN", "Hiragino Sans", "游ゴシック", YuGothic, "メイリオ", Meiryo, sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .content {
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            border-bottom: 3px solid #333;
            padding-bottom: 10px;
            color: #333;
        }
        h2 {
            border-bottom: 2px solid #666;
            padding-bottom: 8px;
            margin-top: 30px;
            color: #444;
        }
        h3 {
            margin-top: 25px;
            color: #555;
        }
        code {
            background-color: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: "SF Mono", "Menlo", "Monaco", "Courier New", monospace;
            font-size: 0.9em;
        }
        pre {
            background-color: #f4f4f4;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border-left: 4px solid #333;
        }
        pre code {
            background-color: transparent;
            padding: 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #f8f8f8;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        a {
            color: #0066cc;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        blockquote {
            border-left: 4px solid #ddd;
            padding-left: 20px;
            margin-left: 0;
            color: #666;
            font-style: italic;
        }
        ul, ol {
            padding-left: 30px;
        }
        li {
            margin: 8px 0;
        }
        hr {
            border: none;
            border-top: 2px solid #ddd;
            margin: 30px 0;
        }
        .toc {
            background-color: #f8f8f8;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        input[type="checkbox"] {
            margin-right: 8px;
        }
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="content">
        <h1 id="shiori-resource-30mmac-ukadoc">SHIORI Resource — <strong>3.0M‑Mac 仕様書（完全版 / UKADOC準拠）</strong></h1>
<p><strong>Status:</strong> Draft / Ourin (macOS 10.15+ / Universal 2)<br />
<strong>Updated:</strong> 2025-07-27 (JST)<br />
<strong>互換方針:</strong> UKADOC「[SHIORI Resourceリスト]」に載る<strong>全要素</strong>の<strong>名称・意味・返値</strong>を踏襲し、<strong>OS 依存値のみ macOS ネイティブ（M‑Diff）</strong>に置換。<br />
<strong>対象:</strong> Ourin（ベースウェア）および SHIORI 実装者。</p>
<blockquote>
<p>典拠: SHIORI Resource の一次情報は UKADOC を参照。項目名や返値の意味は UKADOC が正です。<br />
本仕様は <strong>macOS 移植差分（M‑Diff）</strong>と<strong>実装上の統一方針</strong>を追加定義します。</p>
</blockquote>
<hr />
<h2 id="_1">目次</h2>
<ul>
<li><a href="#1-基本規約">1. 基本規約</a></li>
<li><a href="#2-m-diffmacos-置換点">2. M‑Diff（macOS 置換点）</a></li>
<li><a href="#3-要素一覧完全">3. 要素一覧（完全）</a></li>
<li><a href="#31-shiori情報">3.1 SHIORI情報</a></li>
<li><a href="#32-ゴースト情報">3.2 ゴースト情報</a></li>
<li><a href="#33-更新情報">3.3 更新情報</a></li>
<li><a href="#34-オーナードローメニュー画像">3.4 オーナードローメニュー画像</a></li>
<li><a href="#35-オーナードローメニュー文字色">3.5 オーナードローメニュー文字色</a></li>
<li><a href="#36-オーナードローメニュー項目名caption-系">3.6 オーナードローメニュー項目名（caption 系）</a></li>
<li><a href="#37-ツールチップイベント補足">3.7 ツールチップイベント（補足）</a></li>
<li><a href="#4-返答規則と既定値">4. 返答規則と既定値</a></li>
<li><a href="#5-互換性と注意点">5. 互換性と注意点</a></li>
<li><a href="#6-変更履歴">6. 変更履歴</a></li>
</ul>
<hr />
<h2 id="1">1. 基本規約</h2>
<ul>
<li><strong>文字コード:</strong> 既定 <strong>UTF‑8</strong>。互換のため <strong>CP932/Shift_JIS</strong> 受理→内部 UTF‑8 正規化可。  </li>
<li><strong>改行:</strong> CR+LF を<strong>受理</strong>（内部処理は LF 正規化可）。  </li>
<li><strong>返値の型:</strong> 文字列／数値／ブール（<code>0/1</code> 文字列）／色（R,G,B の整数）など。戻りは<strong>さくらスクリプトでない短文</strong>が基本。  </li>
<li><strong>省略時:</strong> 未対応・未設定は空文字を返す。<code>*.visible</code> は省略時 1（表示）。</li>
</ul>
<h2 id="2-mdiffmacos">2. M‑Diff（macOS 置換点）</h2>
<ul>
<li><strong>パス（<code>*.filename</code> / <code>log_path</code> / 各URL・画像パス）:</strong> <strong>POSIX 絶対パス</strong>または <strong><code>file://</code> URL</strong> を標準。Windows 形式が来た場合は受信側で正規化。  </li>
<li><strong>座標（<code>*.defaultleft</code> / <code>*.defaulttop</code> / 入力ボックス <code>.default*</code>）:</strong> <strong>ディスプレイ座標（ピクセル）</strong>。Ourin 内部では Cocoa の座標系差（原点位置）の吸収を行い、SSP と等価の表示位置になるよう変換。  </li>
<li><strong>色:</strong> <code>menu.*.color.(r|g|b)</code> は <strong>0–255 の整数</strong>を推奨。  </li>
<li><strong>列挙:</strong> <code>popupmenu.type</code> 等の列挙値は <strong>SSP と同義</strong>。未知値は既定動作にフォールバック。</li>
</ul>
<hr />
<h2 id="3">3. 要素一覧（完全）</h2>
<h3 id="31-shiori">3.1 SHIORI情報</h3>
<table>
<thead>
<tr>
<th>Key</th>
<th>意味（要約）</th>
<th>返値の型</th>
<th>備考</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>version</code></td>
<td>SHIORI のバージョン情報（<em>プロトコル版ではない</em>）</td>
<td>文字列</td>
<td>自動返却。</td>
</tr>
<tr>
<td><code>craftman</code></td>
<td>SHIORI 作者名（7bit）</td>
<td>文字列</td>
<td>自動返却。</td>
</tr>
<tr>
<td><code>craftmanw</code></td>
<td>SHIORI 作者名（拡張文字可）</td>
<td>文字列</td>
<td>自動返却。</td>
</tr>
<tr>
<td><code>name</code></td>
<td>SHIORI 名称（ゴースト名ではない、7bit）</td>
<td>文字列</td>
<td>自動返却。</td>
</tr>
<tr>
<td><code>log_path</code></td>
<td>SHIORI ログファイルのフルパス</td>
<td>パス文字列</td>
<td>Ourin は POSIX/<code>file://</code> を受理・推奨。</td>
</tr>
</tbody>
</table>
<h3 id="32">3.2 ゴースト情報</h3>
<table>
<thead>
<tr>
<th>Key</th>
<th>意味（要約）</th>
<th>返値の型</th>
<th>備考</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>homeurl</code></td>
<td>ネットワーク更新用 URL / 位置</td>
<td>URL/文字列</td>
<td><code>descript.txt</code> と併記時の優先は原典参照。</td>
</tr>
<tr>
<td><code>useorigin1</code></td>
<td>更新ファイルカウントの開始数（1:1開始/0:0開始）</td>
<td><code>0/1</code></td>
<td>互換値。</td>
</tr>
<tr>
<td><code>username</code></td>
<td>ユーザー表示名</td>
<td>文字列</td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>デフォルト位置（画像/画面）</strong><br />
| Key | 意味 | 返値 | 備考 |
|---|---|---|---|
| <code>sakura.defaultx</code> / <code>kero.defaultx</code> / <code>char*.defaultx</code> | 画像ベースX | 数値 |  |
| <code>sakura.defaulty</code> / <code>kero.defaulty</code> / <code>char*.defaulty</code> | 画像ベースY | 数値 |  |
| <code>sakura.defaultleft</code> / <code>kero.defaultleft</code> / <code>char*.defaultleft</code> | 画面X | 数値 | M‑Diff: Cocoa 座標を吸収。 |
| <code>sakura.defaulttop</code> / <code>kero.defaulttop</code> / <code>char*.defaulttop</code> | 画面Y | 数値 | 同上。 |</p>
<p><strong>入力ボックス初期位置</strong><br />
<code>(communicatebox|scriptbox|addressbar|teachbox|dateinput|timeinput|ipinput|sliderinput|passwordinput|inputbox).defaultleft</code> / <code>.defaulttop</code> … ディスプレイ座標（ピクセル）。</p>
<p><strong>おすすめ/ポータル</strong><br />
| Key | 意味 | 返値 | 形式 |
|---|---|---|---|
| <code>sakura.recommendsites</code> / <code>kero.recommendsites</code> / <code>char*.recommendsites</code> | おすすめリスト | 連結文字列 | <code>項目名</code>[0x01]<code>url</code>[0x01]<code>バナー画像パス</code>[0x01]<code>選択時トーク</code> [0x02] … |
| <code>sakura.portalsites</code> | ポータルリスト | 連結文字列 | 同上。 |
| <code>sakura.recommendbuttoncaption</code> / <code>kero.*</code> / <code>char*.recommendbuttoncaption</code> | ボタン名 | 文字列 |  |
| <code>updatebuttoncaption</code> / <code>vanishbuttoncaption</code> / <code>readmebuttoncaption</code> | ボタン名 | 文字列 |  |
| <code>vanishbuttonvisible</code> | 消滅通告ボタン表示 | <code>0/1</code> | 省略時 1。 |
| <code>sakura.popupmenu.visible</code> / <code>kero.*</code> / <code>char*.popupmenu.visible</code> | オーナードローメニュー表示 | <code>0/1</code> | |
| <code>sakura.popupmenu.type</code> / <code>kero.*</code> / <code>char*.popupmenu.type</code> | メニュー種別 | 列挙 | SSP 同義。 |
| <code>getaistate</code> | AI 状態 | 文字列 |  |
| <code>getaistateex</code> | AI 状態（複数） | 連結文字列 | 0x01 区切りなど。 |
| <code>legacyinterface</code> | 互換用フラグ | <code>0/1</code> | SSP 互換。 |</p>
<h3 id="33">3.3 更新情報</h3>
<table>
<thead>
<tr>
<th>Key</th>
<th>意味</th>
<th>返値</th>
<th>備考</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>other_homeurl_override</code></td>
<td>他 source の homeurl 上書き</td>
<td>文字列</td>
<td>既定空。</td>
</tr>
</tbody>
</table>
<h3 id="34">3.4 オーナードローメニュー画像</h3>
<table>
<thead>
<tr>
<th>Key</th>
<th>意味</th>
<th>返値</th>
<th>備考</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>menu.sidebar.bitmap.filename</code></td>
<td>サイドバー画像</td>
<td>パス文字列</td>
<td>M‑Diff: POSIX/<code>file://</code>。</td>
</tr>
<tr>
<td><code>menu.background.bitmap.filename</code></td>
<td>背景画像</td>
<td>パス文字列</td>
<td>同上。</td>
</tr>
<tr>
<td><code>menu.foreground.bitmap.filename</code></td>
<td>前景画像</td>
<td>パス文字列</td>
<td>同上。</td>
</tr>
</tbody>
</table>
<h3 id="35">3.5 オーナードローメニュー文字色</h3>
<table>
<thead>
<tr>
<th>Key</th>
<th>意味</th>
<th>返値</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>menu.background.font.color.r/g/b</code></td>
<td>背景用フォント色（RGB）</td>
<td>整数(0–255)</td>
</tr>
<tr>
<td><code>menu.foreground.font.color.r/g/b</code></td>
<td>前景用フォント色（RGB）</td>
<td>整数(0–255)</td>
</tr>
<tr>
<td><code>menu.separator.color.r/g/b</code></td>
<td>セパレータ線色（RGB）</td>
<td>整数(0–255)</td>
</tr>
<tr>
<td><code>menu.frame.color.r/g/b</code></td>
<td>フレーム線色（RGB）</td>
<td>整数(0–255)</td>
</tr>
<tr>
<td><code>menu.disable.font.color.r/g/b</code></td>
<td>無効項目フォント色（RGB）</td>
<td>整数(0–255)</td>
</tr>
</tbody>
</table>
<h3 id="36-caption">3.6 オーナードローメニュー項目名（caption 系）</h3>
<p>以下の <strong><code>.caption</code></strong> キーはメニューに表示するラベル。<strong>Ourin では <code>X.caption</code> に対し <code>X.visible</code>（<code>0/1</code>）も受理</strong>し、未指定は 1（表示）とする。</p>
<pre><code>activaterootbutton.caption, addressbarbutton.caption, alignrootbutton.caption,
alwaysstayontopbutton.caption, alwaystrayiconvisiblebutton.caption,
balloonhistorybutton.caption, balloonrootbutton.caption, biffallbutton.caption,
biffbutton.caption, calendarbutton.caption, callghosthistorybutton.caption,
callghostrootbutton.caption, callsstpsendboxbutton.caption, char*.recommendsites.caption,
charsetbutton.caption, closeballoonbutton.caption, closebutton.caption,
collisionvisiblebutton.caption, configurationbutton.caption, configurationrootbutton.caption,
debugballoonbutton.caption, definedsurfaceonlybutton.caption, dressuprootbutton.caption,
duibutton.caption, enableballoonmovebutton.caption, firststaffbutton.caption,
ghostexplorerbutton.caption, ghosthistorybutton.caption, ghostinstallbutton.caption,
ghostrootbutton.caption, headlinesensehistorybutton.caption, headlinesenserootbutton.caption,
helpbutton.caption, hidebutton.caption, historyrootbutton.caption, inforootbutton.caption,
leavepassivebutton.caption, messengerbutton.caption, pluginhistorybutton.caption,
pluginrootbutton.caption, portalrootbutton.caption, purgeghostcachebutton.caption,
quitbutton.caption, rateofuseballoonbutton.caption, rateofusebutton.caption,
rateofuserootbutton.caption, rateofusetotalbutton.caption, readmebutton.caption,
recommendrootbutton.caption, regionenabledbutton.caption, reloadinfobutton.caption,
resetballoonpositionbutton.caption, resettodefaultbutton.caption, scriptlogbutton.caption,
shellrootbutton.caption, shellscaleotherbutton.caption, shellscalerootbutton.caption,
sntpbutton.caption, switchactivatewhentalkbutton.caption,
switchactivatewhentalkexceptupdatebutton.caption, switchautobiffbutton.caption,
switchautoheadlinesensebutton.caption, switchblacklistingbutton.caption,
switchcompatiblemodebutton.caption, switchconsolealwaysvisiblebutton.caption,
switchconsolevisiblebutton.caption, switchdeactivatebutton.caption,
switchdontactivatebutton.caption, switchdontforcealignbutton.caption,
switchduivisiblebutton.caption, switchforcealignfreebutton.caption,
switchforcealignlimitbutton.caption, switchignoreserikomovebutton.caption,
switchlocalsstpbutton.caption, switchmovetodefaultpositionbutton.caption,
switchproxybutton.caption, switchquietbutton.caption, switchreloadbutton.caption,
switchreloadtempghostbutton.caption, switchremotesstpbutton.caption, switchrootbutton.caption,
switchtalkghostbutton.caption, systeminfobutton.caption, updatebutton.caption,
updatefmobutton.caption, updateplatformbutton.caption, utilityrootbutton.caption,
vanishbutton.caption, aistatebutton.caption, dictationbutton.caption, texttospeechbutton.caption
</code></pre>
<p><strong>ショートカットキー</strong><br />
項目のショートカットキーは UKADOC の「ショートカットキー」節の規定に従う（キー設定で当該項目を起動）。</p>
<h3 id="37">3.7 ツールチップイベント（補足）</h3>
<p><code>tooltip</code> / <code>balloon_tooltip</code> は <strong>ツールチップ表示時に参照されるイベント名</strong>。Ourin は UKADOC の推奨順に解決し、スクリプトを取得して表示する。</p>
<hr />
<h2 id="4">4. 返答規則と既定値</h2>
<ul>
<li>返答は<strong>短いテキスト</strong>（<code>0/1</code> や連結文字列含む）。  </li>
<li><code>*.visible</code> は省略時 1。  </li>
<li>おすすめ/ポータルの<strong>連結形式</strong>は <code>[0x01]</code>（SOH）と <code>[0x02]</code>（STX）で区切る慣例に従う。</li>
</ul>
<h2 id="5">5. 互換性と注意点</h2>
<ul>
<li><strong>SHIORI/3.0 準拠</strong>：Resource は SHIORI/3.0 の<strong>通常イベント扱い</strong>だが、返値がスクリプトではない点に注意。  </li>
<li><strong>未知キー</strong>：Ourin は未知の Resource でも透過で処理可能（将来拡張互換）。  </li>
<li><strong>画像パス</strong>：<code>menu.*.bitmap.filename</code> の相対は<strong>ゴーストルート</strong>基準で解決。</li>
</ul>
<h2 id="6">6. 変更履歴</h2>
<ul>
<li>2025‑07‑27: 初版（3.0M‑Mac、全要素）。</li>
</ul>
        <div class="footer">
            <p>Ourin (桜鈴) - macOS ネイティブ伺かベースウェア</p>
        </div>
    </div>
</body>
</html>