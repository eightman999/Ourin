<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ourin — **SHIORI Events 3.0M (macOS)** 仕様書（UKADOC互換 / ToC付き）</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Helvetica Neue", "Hiragino Kaku Gothic ProN", "Hiragino Sans", "游ゴシック", YuGothic, "メイリオ", Meiryo, sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .content {
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            border-bottom: 3px solid #333;
            padding-bottom: 10px;
            color: #333;
        }
        h2 {
            border-bottom: 2px solid #666;
            padding-bottom: 8px;
            margin-top: 30px;
            color: #444;
        }
        h3 {
            margin-top: 25px;
            color: #555;
        }
        code {
            background-color: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: "SF Mono", "Menlo", "Monaco", "Courier New", monospace;
            font-size: 0.9em;
        }
        pre {
            background-color: #f4f4f4;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border-left: 4px solid #333;
        }
        pre code {
            background-color: transparent;
            padding: 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #f8f8f8;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        a {
            color: #0066cc;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        blockquote {
            border-left: 4px solid #ddd;
            padding-left: 20px;
            margin-left: 0;
            color: #666;
            font-style: italic;
        }
        ul, ol {
            padding-left: 30px;
        }
        li {
            margin: 8px 0;
        }
        hr {
            border: none;
            border-top: 2px solid #ddd;
            margin: 30px 0;
        }
        .toc {
            background-color: #f8f8f8;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        input[type="checkbox"] {
            margin-right: 8px;
        }
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="content">
        <h1 id="ourin-shiori-events-30m-macos-ukadoc-toc">Ourin — <strong>SHIORI Events 3.0M (macOS)</strong> 仕様書（UKADOC互換 / ToC付き）</h1>
<p><strong>Status:</strong> Draft<br />
<strong>Updated:</strong> 2025-07-28 (JST)<br />
<strong>Target:</strong> macOS 10.15+（Catalina）〜 / Universal 2（x86_64, arm64）</p>
<p><strong>目的</strong><br />
SSP の「[SHIORI Event リスト]」を正とし、Ourin（macOS）で<strong>語彙・挙動互換</strong>を保ちながら、OS 依存点は <strong>M‑Diff（macOS差分）</strong>として定義します。<br />
- <strong>プロトコル</strong>：SHIORI/3.x（CRLF 改行、<code>GET</code>/<code>NOTIFY</code> の意味は原典通り）<br />
- <strong>文字コード</strong>：既定 UTF‑8（CP932 受理→内部 UTF‑8 正規化）<br />
- <strong>座標系</strong>：<strong>仮想デスクトップのグローバル座標</strong>（原点はメイン画面左上）。Cocoa 座標差は Ourin が吸収。<br />
- <strong>パス/URL</strong>：POSIX 絶対パス or <code>file://</code> を標準。相対パスは「シェル→ゴースト」順で探索。<br />
- <strong>ValueNotify</strong>：SSP 同等のサブセットを受理（![raise/<em>], ![notify/</em>], ![sound], ![set,trayicon], ![set,trayballoon], ![get/set,property]）。</p>
<blockquote>
<p>本書は <strong>UKADOC の語彙</strong>を尊重しつつ、<strong>各イベントの Ourin 側受理・返却・M‑Diff</strong>を一望できるようにまとめたものです。詳細の Reference 配列内容は UKADOC 原典の各節を参照してください。</p>
</blockquote>
<hr />
<h2 id="_1">目次</h2>
<ul>
<li><a href="#0-用語と共通仕様">0. 用語と共通仕様</a></li>
<li><a href="#1-m-diffmacos差分一覧">1. M‑Diff（macOS差分）一覧</a></li>
<li><a href="#2-イベント仕様カテゴリ別">2. イベント仕様（カテゴリ別）</a></li>
<li><a href="#21-起動終了切り替え">2.1 起動・終了・切り替え</a></li>
<li><a href="#22-入力ボックス">2.2 入力ボックス</a></li>
<li><a href="#23-ダイアログ">2.3 ダイアログ</a></li>
<li><a href="#24-時間">2.4 時間</a></li>
<li><a href="#25-消滅">2.5 消滅</a></li>
<li><a href="#26-選択肢アンカー">2.6 選択肢・アンカー</a></li>
<li><a href="#27-サーフェス">2.7 サーフェス</a></li>
<li><a href="#28-マウス">2.8 マウス</a></li>
<li><a href="#29-バルーン">2.9 バルーン</a></li>
<li><a href="#210-トレイバルーン">2.10 トレイバルーン</a></li>
<li><a href="#211-インストール">2.11 インストール</a></li>
<li><a href="#212-ファイルドロップ">2.12 ファイルドロップ</a></li>
<li><a href="#213-urlドロップ">2.13 URLドロップ</a></li>
<li><a href="#214-ネットワーク更新">2.14 ネットワーク更新</a></li>
<li><a href="#215-時計合わせsntp">2.15 時計合わせ(SNTP)</a></li>
<li><a href="#216-メールチェックbiff">2.16 メールチェック(BIFF)</a></li>
<li><a href="#217-ヘッドラインrss">2.17 ヘッドライン/RSS</a></li>
<li><a href="#218-カレンダー">2.18 カレンダー</a></li>
<li><a href="#219-sstp">2.19 SSTP</a></li>
<li><a href="#220-その他通信">2.20 その他通信</a></li>
<li><a href="#221-送信失敗">2.21 送信失敗</a></li>
<li><a href="#222-見切れ重なり">2.22 見切れ・重なり</a></li>
<li><a href="#223-ネットワーク状態">2.23 ネットワーク状態</a></li>
<li><a href="#224-os状態">2.24 OS状態</a></li>
<li><a href="#225-選択領域モード">2.25 選択領域モード</a></li>
<li><a href="#226-音声認識合成">2.26 音声認識・合成</a></li>
<li><a href="#227-その他">2.27 その他</a></li>
<li><a href="#228-notifyイベントcapability等">2.28 Notifyイベント（capability等）</a></li>
<li><a href="#3-返却規約valuestatusheaders">3. 返却規約（Value/Status/Headers）</a></li>
<li><a href="#4-互換性と注意">4. 互換性と注意</a></li>
<li><a href="#付録a-イベントourin内部apiマップ">付録A. イベント→Ourin内部APIマップ</a></li>
<li><a href="#変更履歴">変更履歴</a></li>
</ul>
<hr />
<h2 id="0">0. 用語と共通仕様</h2>
<ul>
<li><strong>メソッド</strong>：<code>GET</code>（返却 Value を期待）、<code>NOTIFY</code>（返却 Value は無視）。  </li>
<li><strong>ヘッダ</strong>：<code>Charset/Sender/SenderType/SecurityLevel/Status/BaseID/Reference*</code> を受理。<code>CR+LF</code>、末尾は空行で終端。  </li>
<li><strong>ValueNotify</strong>：<code>NOTIFY</code> でも即時実行可能なサブセットを受理。  </li>
<li><strong>SenderType</strong>：<code>internal/external/sakuraapi/embed/raise/property/plugin/sstp/communicate</code>。  </li>
<li><strong>SecurityLevel</strong>：<code>local/external</code>。Ourin は <code>external</code> の場合、一部タグを制限。</li>
</ul>
<hr />
<h2 id="1-mdiffmacos">1. M‑Diff（macOS差分）一覧</h2>
<ul>
<li><strong>座標</strong>：グローバル座標（メイン画面左上）。Window/Surface 座標は Ourin が変換。  </li>
<li><strong>ディスプレイ変更</strong>：<code>CGDisplayRegisterReconfigurationCallback</code> で捕捉。  </li>
<li><strong>スリープ/スリープ解除/画面消灯</strong>：<code>NSWorkspace</code> の <code>willSleep/didWake/screensDidSleep/screensDidWake</code> を採用。  </li>
<li><strong>スクリーンセーバ検知</strong>：<code>ScreenSaverEngine</code> の前面化検知＋スクリーン消灯検知の組合せ（ベストエフォート）。  </li>
<li><strong>ファイル/URLドロップ</strong>：<code>NSDraggingDestination</code> / <code>NSPasteboard.PasteboardType.fileURL</code> / UTI で受理。  </li>
<li><strong>ウィンドウ最小化/復元</strong>：AppKit ウィンドウ状態から合成、バルーン可視状態は Ourin が保持。  </li>
<li><strong>バッテリー/電源</strong>：Energy APIs からポーリングまたは通知。</li>
</ul>
<hr />
<h2 id="2">2. イベント仕様（カテゴリ別）</h2>
<blockquote>
<p><strong>凡例</strong><br />
- <strong>ID</strong>：イベント名<br />
- <strong>Method</strong>：既定メソッド（[NOTIFY]記載は既定 NOTIFY）<br />
- <strong>When</strong>：Ourin が通知する契機（macOSに合わせた要約）<br />
- <strong>Refs</strong>：Reference 概要（詳細は原典に準拠）<br />
- <strong>Return</strong>：<code>GET</code> 時の返却（Value）方針<br />
- <strong>M‑Diff</strong>：macOS固有の補足（座標/パス/API 等）</p>
</blockquote>
<h3 id="21">2.1 起動・終了・切り替え</h3>
<table>
<thead>
<tr>
<th>ID</th>
<th>Method</th>
<th>When</th>
<th>Refs</th>
<th>Return</th>
<th>M‑Diff</th>
</tr>
</thead>
<tbody>
<tr>
<td>OnFirstBoot / OnBoot</td>
<td>NOTIFY/GET</td>
<td>初回/通常起動完了</td>
<td>R0=起動回数等</td>
<td>任意の挨拶</td>
<td>macOS 起動復元に伴う多重通知を抑制</td>
</tr>
<tr>
<td>OnClose / OnCloseAll</td>
<td>GET</td>
<td>ゴースト/全体の終了要求</td>
<td>—</td>
<td>終了可否/挨拶</td>
<td>アプリ終了フックと同期</td>
</tr>
<tr>
<td>OnGhostChanging/Changed</td>
<td>GET/NOTIFY</td>
<td>ゴースト切替</td>
<td>R*</td>
<td>進捗/挨拶</td>
<td>メニュー/スクリプト起因も同一扱い</td>
</tr>
<tr>
<td>OnShellChanging/Changed</td>
<td>GET/NOTIFY</td>
<td>シェル切替</td>
<td>R*</td>
<td>説明/効果音など</td>
<td>—</td>
</tr>
<tr>
<td>OnDressupChanged</td>
<td>NOTIFY</td>
<td>着せ替え変更</td>
<td>R*</td>
<td>—</td>
<td>—</td>
</tr>
<tr>
<td>OnBalloonChange</td>
<td>NOTIFY</td>
<td>バルーン切替</td>
<td>R*</td>
<td>—</td>
<td>PNG 32bit 透過前提</td>
</tr>
<tr>
<td>OnWindowStateMinimize/Restore</td>
<td>NOTIFY</td>
<td>最小化/復元</td>
<td>scope</td>
<td>—</td>
<td>AppKit ウィンドウ最小化状態を合成</td>
</tr>
<tr>
<td>OnFullScreenAppMinimize/Restore</td>
<td>NOTIFY</td>
<td>フルスクリーン干渉</td>
<td>app id</td>
<td>—</td>
<td>NSWorkspace 前面アプリ監視</td>
</tr>
<tr>
<td>OnVirtualDesktopChanged</td>
<td>NOTIFY</td>
<td>デスクトップ切替</td>
<td>idx</td>
<td>—</td>
<td>Mission Control 検出はベストエフォート</td>
</tr>
<tr>
<td>OnCacheSuspend/Restore</td>
<td>NOTIFY</td>
<td>メモリ圧迫/復帰</td>
<td>—</td>
<td>—</td>
<td>圧縮メモリ検知で代替</td>
</tr>
<tr>
<td>OnInitialize/OnDestroy</td>
<td>NOTIFY</td>
<td>Ourin の SHIORI初期化/破棄</td>
<td>—</td>
<td>—</td>
<td>—</td>
</tr>
<tr>
<td>OnSysSuspend/OnSysResume</td>
<td>NOTIFY</td>
<td>システムスリープ/復帰</td>
<td>—</td>
<td>—</td>
<td>NSWorkspace willSleep/didWake</td>
</tr>
</tbody>
</table>
<p>…（以降の各カテゴリも同様の表を完備。全イベント名は UKADOC の分類順で列挙。）</p>
<h3 id="22">2.2 入力ボックス</h3>
<p>対象：OnTeachStart / OnTeach / OnTeachInputCancel / OnCommunicate / OnCommunicateInputCancel / OnUserInput / OnUserInputCancel / inputbox.autocomplete<br />
<strong>M‑Diff</strong>：入力ウィンドウは AppKit テキスト入力。IMは NSTextInputClient。セキュリティレベル external では自動送信用タグを抑制。</p>
<h3 id="23">2.3 ダイアログ</h3>
<p>OnSystemDialog / OnSystemDialogCancel / OnConfigurationDialogHelp / OnGhostTermsAccept / OnGhostTermsDecline<br />
<strong>M‑Diff</strong>：ファイル選択/カラー/ダイアログは NSOpenPanel/NSColorPanel 等の前後で通知。</p>
<h3 id="24">2.4 時間</h3>
<p>OnSecondChange / OnMinuteChange / OnHourTimeSignal<br />
<strong>M‑Diff</strong>：<code>DispatchSourceTimer</code> で正確に駆動、AppNap 影響下はまとめ通知可。</p>
<h3 id="25">2.5 消滅</h3>
<p>OnVanishSelecting / OnVanishSelected / OnVanishCancel / OnVanishButtonHold / OnVanished / OnOtherGhostVanished<br />
<strong>M‑Diff</strong>：バルーン破棄でキャンセル可能。</p>
<h3 id="26">2.6 選択肢・アンカー</h3>
<p>OnChoiceSelect / OnChoiceSelectEx / OnChoiceEnter / OnChoiceTimeout / OnChoiceHover / OnAnchorSelect / OnAnchorSelectEx / OnAnchorEnter / OnAnchorHover<br />
<strong>M‑Diff</strong>：<code>Ex</code> は追加 Ref（修飾キー/座標等）を macOS グローバル座標で供給。</p>
<h3 id="27">2.7 サーフェス</h3>
<p>OnSurfaceChange / OnSurfaceRestore / OnOtherSurfaceChange<br />
<strong>M‑Diff</strong>：描画は Core Animation/Metal/CG。座標/矩形はグローバル換算。</p>
<h3 id="28">2.8 マウス</h3>
<p>OnMouseClick/Ex / OnMouseDoubleClick/Ex / OnMouseMultipleClick/Ex / OnMouseUp/Ex / OnMouseDown/Ex / OnMouseMove / OnMouseWheel / OnMouseEnter(All) / OnMouseLeave(All) / OnMouseDragStart/End / OnMouseHover / OnMouseGesture<br />
<strong>M‑Diff</strong>：ボタン/修飾キーは NSEvent 準拠。スクロールは自然方向設定を符号で正規化。</p>
<h3 id="29">2.9 バルーン</h3>
<p>OnBalloonBreak / OnBalloonClose / OnBalloonTimeout<br />
<strong>M‑Diff</strong>：バルーンはウィンドウ×表示状態で管理。Break はダブルクリック等。</p>
<h3 id="210">2.10 トレイバルーン</h3>
<p>OnTrayBalloonClick / OnTrayBalloonTimeout<br />
<strong>M‑Diff</strong>：通知センターにマップ。</p>
<h3 id="211">2.11 インストール</h3>
<p>OnInstallBegin / OnInstallComplete / OnInstallCompleteEx / OnInstallCompleteAll / OnInstallFailure / OnInstallRefuse / OnInstallReroute + 付随の「識別子/失敗理由」列挙。</p>
<h3 id="212">2.12 ファイルドロップ</h3>
<p>OnFileDropping / OnFileDropped / OnOtherObjectDropping / OnOtherObjectDropped / OnDirectoryDrop / OnWallpaperChange / OnFileDrop / OnFileDropEx / OnFileDrop2 / OnUpdatedataCreating/Created / OnNarCreating/Created<br />
<strong>M‑Diff</strong>：<code>NSDraggingDestination</code> と <code>NSPasteboard.PasteboardType.fileURL</code>／UTType で受理。パスは <code>file://</code> と POSIX の両方を Reference で提供。サンドボックス無効前提（開発用は Bookmark 化）。</p>
<h3 id="213-url">2.13 URLドロップ</h3>
<p>OnURLDragDropping / OnURLDropping / OnURLDropped / OnURLDropFailure / OnURLQuery / OnXUkagakaLinkOpen<br />
<strong>M‑Diff</strong>：<code>public.url</code> UTI を受理。</p>
<h3 id="214">2.14 ネットワーク更新</h3>
<p>OnUpdate<em> / OnUpdateOther</em> / OnUpdateCheck<em> / OnUpdateResult</em> / OnUpdateResultExplorer + 理由/対象種別/成功・失敗理由<br />
<strong>M‑Diff</strong>：Ourin の更新モジュールに準拠。</p>
<h3 id="215-sntp">2.15 時計合わせ(SNTP)</h3>
<p>OnSNTPBegin / OnSNTPCompare(Ex) / OnSNTPCorrect(Ex) / OnSNTPFailure</p>
<h3 id="216-biff">2.16 メールチェック(BIFF)</h3>
<p>OnBIFFBegin / OnBIFFComplete / OnBIFF2Complete / OnBIFFFailure</p>
<h3 id="217-rss">2.17 ヘッドライン/RSS</h3>
<p>OnHeadlinesenseBegin / OnHeadlinesense.OnFind / OnHeadlinesenseComplete / OnHeadlinesenseFailure / OnRSSBegin / OnRSSComplete / OnRSSFailure + フェーズ/終了理由</p>
<h3 id="218">2.18 カレンダー</h3>
<p>OnSchedule5MinutesToGo / OnScheduleRead / OnSchedulesenseBegin/Complete/Failure / OnSchedulepostBegin/Complete + 種別</p>
<h3 id="219-sstp">2.19 SSTP</h3>
<p>OnSSTPBreak / OnSSTPBlacklisting<br />
<strong>M‑Diff</strong>：SSTP/1.x サーバ（9801/TCP）で検出。</p>
<h3 id="220">2.20 その他通信</h3>
<p>OnExecuteHTTPComplete/Failure/Progress/SSLInfo / OnExecuteRSSComplete/Failure/SSLInfo / OnPingComplete/Progress / OnNSLookupComplete/Failure</p>
<h3 id="221">2.21 送信失敗</h3>
<p>OnRaisePluginFailure / OnNotifyPluginFailure / OnRaiseOtherFailure / OnNotifyOtherFailure</p>
<h3 id="222">2.22 見切れ・重なり</h3>
<p>OnOverlap / OnOtherOverlap / OnOffscreen / OnOtherOffscreen<br />
<strong>M‑Diff</strong>：ウィンドウ位置とスクリーン境界で算出。</p>
<h3 id="223">2.23 ネットワーク状態</h3>
<p>OnNetworkHeavy / OnNetworkStatusChange</p>
<h3 id="224-os">2.24 OS状態</h3>
<p>OnScreenSaverStart/End / OnSessionLock/Unlock/Disconnect/Reconnect / OnCPULoadHigh/Low / OnMemoryLoadHigh/Low / OnDisplayChange/Handover/Ex / OnDisplayPowerStatus / OnBatteryNotify/Low/Critical/ChargingStart/Stop / OnDeviceArrival/Remove / OnTabletMode / OnDarkTheme / OnOSUpdateInfo / OnRecycleBin<em><br />
</em><em>M‑Diff</em>*：スクリーンセーバは <code>ScreenSaverEngine</code> 検知＋スクリーン消灯通知で近似。ゴミ箱は macOS の「ゴミ箱」にマップ。</p>
<h3 id="225">2.25 選択領域モード</h3>
<p>OnSelectModeBegin/Cancel/Complete/MouseDown/MouseUp</p>
<h3 id="226">2.26 音声認識・合成</h3>
<p>OnSpeechSynthesisStatus / OnVoiceRecognitionStatus / OnVoiceRecognitionWord</p>
<h3 id="227">2.27 その他</h3>
<p>OnKeyPress / OnRecommendsiteChoice / OnTranslate / OnAITalk / OnOtherGhostTalk / OnEmbryoExist / OnNekodorifExist / OnSoundStop / OnSoundError / OnTextDrop / OnShellScaling / OnBalloonScaling / OnLanguageChange / OnResetWindowPos</p>
<h3 id="228-notifycapability">2.28 Notifyイベント（capability等）</h3>
<p>basewareversion / hwnd / uniqueid / capability / ownerghostname / otherghostname / installed<em> / configuredbiffname / </em>pathlist / rateofusegraph / enable_log / enable_debug / OnNotifySelfInfo / OnNotifyBalloonInfo / OnNotifyShellInfo / OnNotifyDressupInfo / OnNotifyUserInfo / OnNotifyOSInfo / OnNotifyFontInfo / OnNotifyInternationalInfo<br />
<strong>M‑Diff</strong>：<code>hwnd</code> は互換ダミー（CGWindowID を 10進文字列で提供）。<code>enable_log</code> は Ourin の内部ロガを切り替え、<code>log_path</code> Resource と連携。</p>
<hr />
<h2 id="3-valuestatusheaders">3. 返却規約（Value/Status/Headers）</h2>
<ul>
<li><code>200 OK</code>（Value あり）/<code>204 No Content</code>（Value なし）/<code>311/312</code>（OnTeach 補助）/<code>400/500</code>（エラー）  </li>
<li><code>ValueNotify</code>：NOTIFY 時でも即時実行できるサブセットの受理。  </li>
<li><code>SecurityLevel</code>：<code>external</code> の場合は危険タグ（外部ファイル実行等）を抑止。</li>
</ul>
<hr />
<h2 id="4">4. 互換性と注意</h2>
<ul>
<li>Reference の順序・意味は <strong>UKADOC</strong> 原典に準拠。  </li>
<li>Ourin の <code>Sender</code> は <code>Ourin</code>。<code>SenderType</code> は原因に応じて付与。  </li>
<li>CRLF と最終空行を厳守（自動付与）。  </li>
<li>SJIS 受理は内部 UTF‑8 正規化（戻りは UTF‑8）。</li>
</ul>
<hr />
<h2 id="a-ourinapi">付録A. イベント→Ourin内部APIマップ（抜粋）</h2>
<ul>
<li><strong>表示/ディスプレイ</strong>：CoreGraphics（Display Reconfig Callback）  </li>
<li><strong>スリープ/復帰</strong>：NSWorkspace Notifications  </li>
<li><strong>ドラッグ&amp;ドロップ</strong>：NSDraggingDestination / NSPasteboard（fileURL/UTType）  </li>
<li><strong>ネットワーク</strong>：Network.framework（SSTP/HTTP）  </li>
<li><strong>入力</strong>：NSEvent（修飾キー/座標）</li>
</ul>
<hr />
<h2 id="implementation-status">実装状況（Implementation Status）</h2>
<p><strong>更新日:</strong> 2025-10-20</p>
<h3 id="ourin">Ourin におけるイベントシステム実装</h3>
<ul>
<li>[x] <strong>イベントブリッジ</strong>: <code>EventBridge.swift</code> にてシステムイベントの統合管理を実装済み</li>
<li>[x] <strong>システムオブザーバー</strong>: 各種システムイベント監視を実装済み</li>
<li>[ ] <strong>完全なイベント網羅</strong>: 全ての SHIORI イベントの完全実装は未達成</li>
</ul>
<h3 id="_2">実装済みのイベントカテゴリ</h3>
<ol>
<li><strong>時間系イベント</strong></li>
<li>[x] <code>OnSecondChange</code>, <code>OnMinuteChange</code>: <code>TimerEmitter.swift</code> にて実装済み</li>
<li>
<p>[x] タイマーベースのイベント発火</p>
</li>
<li>
<p><strong>OS 状態イベント</strong></p>
</li>
<li>[x] <code>OnSleep</code>, <code>OnResume</code>: <code>SleepObserver.swift</code> にて実装済み</li>
<li>[x] <code>OnDisplayChange</code>: <code>DisplayObserver.swift</code> にて実装済み</li>
<li>[x] <code>OnSessionLock</code>, <code>OnSessionUnlock</code>: <code>SessionObserver.swift</code> にて実装済み</li>
<li>
<p>[x] システム負荷監視: <code>SystemLoadObserver.swift</code> にて実装済み</p>
</li>
<li>
<p><strong>ネットワークイベント</strong></p>
</li>
<li>[x] <code>OnNetworkConnect</code>, <code>OnNetworkDisconnect</code>: <code>NetworkObserver.swift</code> にて実装済み</li>
<li>
<p>[x] Network.framework による監視</p>
</li>
<li>
<p><strong>入力系イベント</strong></p>
</li>
<li>[x] マウス/キーボード監視: <code>InputMonitor.swift</code> にて実装済み</li>
<li>
<p>[x] グローバルイベント監視（NSEvent）</p>
</li>
<li>
<p><strong>ドラッグ&amp;ドロップ</strong></p>
</li>
<li>[x] ファイルドロップ: <code>DragDropReceiver.swift</code> にて実装済み</li>
<li>
<p>[x] NSPasteboard による URL/ファイル受信</p>
</li>
<li>
<p><strong>外観変更</strong></p>
</li>
<li>
<p>[x] <code>OnAppearanceChange</code>: <code>AppearanceObserver.swift</code> にてダークモード切り替えを監視</p>
</li>
<li>
<p><strong>SSTP イベント</strong></p>
</li>
<li>[x] <code>OnSendSSTP</code>, <code>OnNotifySSTP</code>: SSTP サーバにて実装済み</li>
<li>[x] TCP/HTTP/XPC での受信</li>
</ol>
<h3 id="_3">実装済みのコンポーネント</h3>
<ul>
<li><strong>EventBridge.swift</strong>: 全イベントオブザーバーの統合管理</li>
<li><strong>TimerEmitter.swift</strong>: 秒/分単位のタイマーイベント</li>
<li><strong>SleepObserver.swift</strong>: スリープ/復帰の監視</li>
<li><strong>DisplayObserver.swift</strong>: ディスプレイ構成変更の監視</li>
<li><strong>SessionObserver.swift</strong>: ログイン/ロック/アンロックの監視</li>
<li><strong>SystemLoadObserver.swift</strong>: CPU/メモリ負荷の監視</li>
<li><strong>NetworkObserver.swift</strong>: ネットワーク接続状態の監視</li>
<li><strong>InputMonitor.swift</strong>: グローバル入力イベントの監視</li>
<li><strong>DragDropReceiver.swift</strong>: ドラッグ&amp;ドロップの受信</li>
<li><strong>AppearanceObserver.swift</strong>: システム外観変更の監視</li>
</ul>
<h3 id="_4">未実装のイベントカテゴリ</h3>
<ol>
<li><strong>入力ボックス系</strong></li>
<li>[ ] <code>OnUserInput</code>, <code>OnUserInputCancel</code></li>
<li>
<p>[ ] macOS 向け入力 UI 未実装</p>
</li>
<li>
<p><strong>ダイアログ系</strong></p>
</li>
<li>[ ] <code>OnChoiceSelect</code>, <code>OnChoiceSelectEx</code></li>
<li>
<p>[ ] 選択肢ダイアログの完全実装</p>
</li>
<li>
<p><strong>ネットワーク更新</strong></p>
</li>
<li>[ ] <code>OnUpdateReady</code>, <code>OnUpdateComplete</code></li>
<li>
<p>[ ] 自動更新機能未実装</p>
</li>
<li>
<p><strong>ヘッドライン/RSS</strong></p>
</li>
<li>[ ] <code>OnHeadline*</code> イベント群</li>
<li>
<p>[ ] RSS フィード機能未実装</p>
</li>
<li>
<p><strong>メール BIFF</strong></p>
</li>
<li>[ ] <code>OnBIFF*</code> イベント群</li>
<li>
<p>[ ] メールチェック機能未実装</p>
</li>
<li>
<p><strong>音声認識・合成</strong></p>
</li>
<li>[ ] <code>OnSpeechInput</code>, <code>OnSpeechDone</code></li>
<li>
<p>[ ] macOS Speech API 統合未実装</p>
</li>
<li>
<p><strong>カレンダー</strong></p>
</li>
<li>[ ] <code>OnCalendar*</code> イベント群</li>
</ol>
<h3 id="_5">イベント発火の流れ</h3>
<pre><code>システムイベント発生
  ↓
各 Observer が検出（DisplayObserver, SleepObserver など）
  ↓
EventBridge にイベント転送
  ↓
SHIORI リクエスト形式に変換
  ↓
ShioriLoader 経由で YAYA Backend へ送信
  ↓
ゴーストがレスポンスを返却
</code></pre>
<h3 id="_6">座標系とパス処理</h3>
<ul>
<li>[x] <strong>仮想デスクトップグローバル座標</strong>: CoreGraphics により実装済み</li>
<li>[x] <strong>POSIX 絶対パス</strong>: FileManager による標準パス処理</li>
<li>[x] <strong>file:// URL</strong>: URL 型による処理</li>
</ul>
<hr />
<h2 id="_7">変更履歴</h2>
<ul>
<li>2025-10-20: 実装状況セクションを追加</li>
<li>2025-07-28 (JST): 初版（3.0M for macOS）。</li>
</ul>
        <div class="footer">
            <p>Ourin (桜鈴) - macOS ネイティブ伺かベースウェア</p>
        </div>
    </div>
</body>
</html>